<!doctype html>

<html manifest="/cache.manifest">

<head>
    <meta charset="utf-8" />
    <title>test app Mòbil</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="" />
    <meta name="viewport" content="width=device-width; initial-scale=1" />

    <!-- !CSS -->
    <link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet" type="text/css" />
    <link href="css/jquery.mobile.datebox-1.0.1.min.css" rel="stylesheet" type="text/css" />
    <link href="css/themes/Rojos/ROJOS.css" rel="stylesheet" />
    <!--<link href="css/themes/Rojos/ROJOS.min.css" rel="stylesheet" />-->

    <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="js/jquery.json-2.2.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.mobile.datebox-1.0.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.ba-dotimeout.min.js" type="text/javascript"></script>

    <!-- Base de dades (localStorage) -->
    <script src="js/jstorage.js" type="text/javascript"></script>

    <!-- Negocio  -->
    <script src="negocio/index.js" type="text/javascript"></script>
    <script src="negocio/negoci.js" type="text/javascript"></script>
    <script src="negocio/baseDades.js" type="text/javascript"></script>
    <script src="negocio/webService.js" type="text/javascript"></script>
    <script src="negocio/utilitats.js" type="text/javascript"></script>
    <!--afegint les noves-->
    <script src="negocio/pagePantalla1.js" type="text/javascript"></script>

    <script src="negocio/pageNuevaIncidencia.js" type="text/javascript"></script>
    <script src="negocio/pageConsultaIncidencias.js" type="text/javascript"></script>

    <!-- objetos -->
    <script src="objetos/usuari.js" type="text/javascript"></script>
    <script src="objetos/carrer.js" type="text/javascript"></script>
    <script src="objetos/comunicat.js" type="text/javascript"></script>

    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&language=ca-ES"></script>

    <script type="text/javascript" charset="utf-8" src="EmailComposer.js"></script>

</head>

<!--hgs Nov14
<body  style="margin:auto;width: 100%; height: 800px">-->
<body>
<!-- Página Principal  -->
<div data-role="page" id="pageIndex">
    <div data-role="header" data-theme="c">
        <h3>Nova app</h3>
    </div>
    <div data-role="content" data-theme="c">
        <div data-role="controlgroup" data-type="horizontal" style="text-align: center;">
            <!--<a href="" onclick="bAbroPagina=true; abrirPagina('pageNuevaIncidencia',false)" id="buttonALTA" data-mini="false" data-inline="false" data-role="button" data-theme="c">Nou <br/>comunicat</a>
            <a href="" onclick="abrirPagina('pageConsultaIncidencias', false)" id="buttonCONSULTA" data-mini="false" data-inline="false" data-role="button" data-theme="c">Els meus <br/>comunicats</a>-->

            <a href="" onclick="bAbroPagina=true; abrirPagina('pagePantalla1',false)" id="buttonP1" data-mini="false" data-inline="false" data-role="button" data-theme="c">P1<br/>Items</a>
            <a href="" onclick="abrirPagina('pagePantalla2', false)" id="buttonP2" data-mini="false" data-inline="false" data-role="button" data-theme="c">P2<br/>Camara</a>
            <a href="" onclick="abrirPagina('pagePantalla3', false)" id="buttonP3" data-mini="false" data-inline="false" data-role="button" data-theme="c">P3<br/>Resum</a>
            <a href="" onclick="abrirPagina('pagePantalla4', false)" id="buttonP4" data-mini="false" data-inline="false" data-role="button" data-theme="c">P4<br/>Dades</a>
            <a href="" onclick="abrirPagina('pagePantalla5', false)" id="buttonP5" data-mini="false" data-inline="false" data-role="button" data-theme="c">P5<br/>Enviats</a>
            <a href="" onclick="abrirPagina('pagePantalla6', false)" id="buttonP6" data-mini="false" data-inline="false" data-role="button" data-theme="c">P6<br/>FeedBack</a>

        </div>
    </div>
    <!--<div data-role="footer" data-theme="f" style="text-align:center;" data-position="fixed">
    </div>-->
</div>

<!--SELECCIO ITEM-->
<div data-role="page" id="pagePantalla1">
<div data-role="header" data-theme="c">
    <h5>Tipus incidència</h5>
    </div>
    <div data-role="content" data-theme="c" data-mini="false">
        <!--Tipo incidencia-->
        <table style="width: 100%; vertical-align: top;">
            <tr>
                <td><div id="divImagenes"></div></td>
            </tr>
        </table>
    </div>
</div>

<!-- CAMARA -->
<div data-role="page" id="pagePantalla2">
    <div data-role="header" data-theme="c">
        <table style="text-align: center; width: 100%">
            <tr>
                <td style="text-align: left">
                    <h4>Camara</h4>
                </td>
            </tr>
        </table>
    </div>
    <div data-role="content" data-theme="c" data-mini="false">
            <div id="acordeon2" data-role="collapsible-set" data-mini="false" data-collased-icon="arrow-r" data-expanded-icon="arrow-l" data-thene="b" data-content-theme="b">
             <!-- F O T O -->
                <div data-role="collapsible" data-mini="false" id="collapsibleFoto"  data-collapsed="true">
                    <h3><table style="width:100%;"><tr><td style="text-align:left; width:100%;">prova fotogràfica</td>
                        <td style="text-align:right;">
                            <img id="imgCamara" src="images/ico_camara.png" onclick="hacerFoto('CAMARA');" />
                        </td>
                    </tr></table>
                    </h3>
                    <div>
                        <table style="width: 100%;">
                            <tr>
                                <td rowspan='2' style="text-align: right;">
                                    <img id="imgFoto1" src="" width="100%" height="auto" border='1' onclick="abrirPagina('pageZoomFoto', false);" />
                                </td>
                                <td style="text-align: left; vertical-align: top">
                                    <a href="#pageEliminarFoto" id="buttonEliminarFoto" data-rel="popup" data-position-to="window" data-role="button" data-inline="true" data-transition="pop" data-theme="c" data-mini="true">no adjuntar</a>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: left; vertical-align: bottom;"><label>(capturant foto s'actualitza l'adreça)</label></td>
                            </tr>
                        </table>
                    </div>
                </div>

            </div>
    </div>
    <!-- PopUp ELIMINAR foto -->
    <div data-role="popup" id="pageEliminarFoto"  data-theme="c" style="max-width:99%;" class="ui-corner-all">
        <div data-role="header" data-theme="a" class="ui-corner-top">
            <h1>Eliminar foto</h1>
        </div>
        <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
            <h3 class="ui-title">Vol descartar la fotografia?</h3>
            <!-- <div data-role="controlgroup" data-type="horizontal"> he modificat # per #pageNuevaIncidencia
            <a href="#" data-role="button" data-mini="false" data-inline="true" data-rel="back" data-theme="c">cancel·lar</a>
            <a href="#" data-role="button" data-mini="false" data-inline="true" data-rel="back" data-transition="flow" data-theme="b" onclick="eliminarFoto()">si</a>
            -->
            <a href="#pageNuevaIncidencia" data-role="button" data-mini="false" data-inline="true" data-theme="c">no</a>
            <a href="#pageNuevaIncidencia" data-role="button" data-mini="false" data-inline="true" data-transition="flow" data-theme="b" onclick="eliminarFoto()">si</a>
            <!--</div>-->
        </div>
    </div>
</div>

<!-- RESUM -->
<div data-role="page" id="pagePantalla3">
    <div data-role="header" data-theme="c">
    <h5>Resum</h5>
    </div>
    <div data-role="content" data-theme="c" data-mini="false">
                <!-- L O C A L I T Z A C I Ó abans data-collapsed='false' -->
                   <!-- <div id='divMensajeMapa'><label>la localització sobre plànol no ha estat possible</label></div>-->
                    <!-- <div id="divContieneMapa" class="ui-bar-c ui-corner-all ui-shadow"  style="height:300px;padding:1em;"> -->
                    <div class="ui-bar-c ui-corner-all ui-shadow" style="margin: 0">
                        <table style="margin: 0;">
                            <tr style="margin: 0;">
                                <td style="margin: 0;">
                                    <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                        <img src="images/P7220021.JPG" border="0" width="100%" height="auto" />
                                    </a>
                                </td>
                                <td style="margin: 0;">
                                    <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                        <img src="imagenes/1191_on.png" border="0" width="auto" height="auto"/>
                                    </a>
                                </td>
                            </tr>
                            <tr style="margin: 0;"><td colspan="2" style="margin: 0;"><hr></td></tr>
                            <tr style="margin: 0;">
                                <td colspan="2" style="margin: 0;">
                                    <label id="labelDireccion" style="font-size:x-small;"></label>
                                    <a href="#" data-rel="popup" data-role="button" data-transition="pop" data-icon="refresh" data-iconpos="notext" data-inline="true" data-mini="true" onclick="actualizaDireccion();"></a>
                                </td>
                            </tr>
                            <tr style="margin: 0;">
                                <td colspan="2" style="margin: 0;"><div id="divMapaAlta" style="height:100px;"></div></td>
                            </tr>
                            <tr style="margin: 0;"><td colspan="2" style="margin: 0;"><hr></td></tr>
                            <tr style="margin: 0;">
                                <td style="margin: 0;">
                                    <input type="text" name="textareaComentari" id="textareaComentari" placeholder="observacions" data-clear-btn="true" />
                                </td>
                                <td style="margin: 0;">
                                    <a data-role="button" href="#" data-shadow="false" data-theme="none">
                                        <img src="imagenes/grabadora.JPG" border="0" width="100%" height="auto" />
                                    </a>
                                </td>
                            </tr>
                            <tr style="margin: 0;"><td colspan="2" style="margin: 0;"><hr></td></tr>
                        </table>
                        <div style="text-align:right;">
                            <a href="#" id="buttonEnviar" onclick="enviarIncidencia()" data-mini="true" data-inline="true" data-role="button" data-theme="c">Enviar</a>
                        </div>
                    </div>
    </div>
</div>

<!-- USUARI -->
<div data-role="page" id="pagePantalla4">
    <div data-role="header" data-theme="c">
        <h5>Dades</h5>
    </div>

    <div data-role="content" data-theme="c" data-mini="false">
             <!-- U S U A R I O -->
                <div data-role="fieldcontain">
                     <!-- <label for="inputNOM">nom</label> -->
                    <input type="text" name="inputNOM" id="inputNOM" data-inline="true" data-mini="true" data-theme="d" placeholder="el meu nom ..." data-clear-btn="true" onFocus="javascript:location.href='#posInicio'"/>
                    <!-- <label for="inputCOGNOM1">primer cognom</label> -->
                    <input type="text" name="inputCOGNOM1" id="inputCOGNOM1" data-inline="true" data-mini="true" data-theme="d" placeholder="el meu primer cognom ..." data-clear-btn="true"/>
                    <!-- <label for="inputCOGNOM2">segon cognom</label> -->
                    <input type="text" name="inputCOGNOM2" id="inputCOGNOM2" data-inline="true" data-mini="true" data-theme="d" placeholder="el meu segon cognom ..." data-clear-btn="true"/>
                    <!-- <label for="inputDNI">dni</label> -->
                    <input type="text" name="inputDNI" id="inputDNI" data-inline="true" data-mini="true" data-theme="d" placeholder="el meu dni ..." data-clear-btn="true"/>
                    <!-- <label for="inputEMAIL">email</label> -->
                    <input type="text" name="inputEMAIL" id="inputEMAIL" data-inline="true" data-mini="true" data-theme="d" placeholder="la meva adreça electrónica ..." data-clear-btn="true"/>
                    <!-- <label for="inputTEL">telèfon</label> -->
                    <input type="text" name="inputTELEFON" id="inputTELEFON" data-inline="true" data-mini="true" data-theme="d" placeholder="el meu telèfon mòbil ..." data-clear-btn="true"/>
                </div>

                <!-- Aniran els botons de usuari-->
                <div style="text-align:right;">
                    <a href="#" id="buttonNetejar" onclick="netejarDades()" data-mini="true" data-inline="true" data-role="button" data-theme="c">Netejar</a>
                    <a href="#" id="buttonDesar"  data-mini="true" data-inline="true" data-role="button" data-theme="c">Desar</a>
                </div>
    </div>
</div>

<!-- COMUNICATS -->
<div data-role="page" id="pagePantalla5">
    <div data-role="header" data-theme="c">
        <h5>Comunicats</h5>
    </div>
    <!-- Panel lateral -->
    <div data-role="panel" id="panelDadesComunicat" data-position="right" data-display="reveal" data-animate="true">
        <div data-role="content" data-theme="e" class="ui-corner-all">
            <table>
                <tr><td style="text-align:right; color:#970824; font-weight: bold; font-size: small">comunicat</td><td style="font-size: small"><label id="labelCOMUNICAT_ID"></label></td></tr>
                <tr><td colspan="2" style="font-weight: bold; font-size: small;"><label id="labelCOMUNICAT_COMENTARI"></label></td></tr>
                <tr><td colspan="2"></td></tr>
                <tr><td style="text-align:right; color:#970824; font-weight: bold; font-size: small">quan</td><td style="font-size: small"><label id="labelCOMUNICAT_DATA"></label></td></tr>
                <tr><td style="text-align:right; color:#970824; font-weight: bold; font-size: small">on</td><td style="font-size: small"><label id="labelCOMUNICAT_CARRER"></label>,<label id="labelCOMUNICAT_NUM"></label></td></tr>
                <tr><td style="text-align:right; color:#970824; font-weight: bold; font-size: small">referència</td><td style="font-size: small"><label id="labelCOMUNICAT_REFERENCIA"></label></td></tr>
                <tr><td style="text-align:right; color:#970824; font-weight: bold; font-size: small">estat</td><td style="font-size: small"><label id="labelCOMUNICAT_ESTAT"></label></td></tr>
                <tr><td colspan="2" style="color: #d3d3d3; font-size: xx-small;"><label id="labelCOMUNICAT_COORDENADES"></label></td></tr>
            </table>
        </div>
        <a href="#" id="buttonCerrarPanel" onclick="$('#panelDadesComunicat').panel('close')" data-mini="true" data-inline="false" data-role="button" data-theme="c" data-icon="arrow-l">tornar</a>
    </div>
    <div data-role="content" data-theme="a">
        <div id="divListaIncidencias" style="margin-top:0; vertical-align:top;">
            <ul data-role="listview" data-divider-theme="a" data-inset="true">
                <!--<li data-role="list-divider" role="heading" id="liCabeceraComunicatsReportats"></li>-->
                <li data-theme="b">
                    <table style='height:10px; width:100%;'><tr>
                        <td style='text-align:left; font-size:small; width: 15%; color: #000000;'>id</td>
                        <td style='text-align:left; font-size:small; width: 55%; color: #000000;'>estat</td>
                        <td style='text-align:left; font-size:small; width: 30%; color: #000000;'>referència</td>
                    </tr></table>
                    <div class="content-primary" id="divLista">
                        <ul data-role="listview" id="listviewLista" data-filter="false" data-inset="true"  data-theme="d" data-divider-theme="b">
                        </ul>
                    </div>
                </li>
                <li data-role="list-divider" role="footer" id="liPieComunicatsReportats" style="text-align: center;">
                    <table style="width:100%;"><tr><td style="text-align: left; width: 50%;">
                      <td>
                        <a href="#" id="buttonBorrarHistoricoComunicados" onclick="borrarHistoricoComunicados()" data-mini="true" data-inline="true"data-role="button"data-theme="c" data-icon="delete">Netejar</a>
                       </td>
                       <!--<td>
                            <a href="#" id="buttonEnviamentDePendents" onclick="enviamentDePendents()" data-mini="true" data-inline="true" data-role="button" data-theme="c" data-icon="plus">actualitzar</a>
                        </td>-->
                        <td>
                            <a href="#" id="buttonMostrarEnPlano" onclick="estadoDelPlano()" data-mini="true" data-inline="true" data-role="button"  data-icon="grid" data-theme="c">plànol</a>
                        </td>
                    </tr>
                    </table>
                </li>
            </ul>
            <!-- P L A N O -->
            <!--<div id="divSobreMapaConsulta" data-theme="e" class="ui-corner-all">-->
            <div id="divSobreMapaConsulta" class="ui-bar-c ui-corner-all ui-shadow" style="padding:1em;">
                <div id="divMapaConsulta" style="height:300px;"></div>
                <a href="#" id="buttonSubirEnPlano" onclick="estadoDelPlano()" data-mini="true" data-inline="false" data-role="button" data-theme="c" data-icon="arrow-u">pujar</a>
            </div>
        </div>
    </div>
    <!-- <div data-role="footer" data-theme="f" data-position="fixed" style="text-align: center;">
         <table style="width:100%;"><tr><td style="background-color:LightGrey; width:100%;"><label   style="color:Gray; font-size:small; font-weight:normal; background-color:LightGrey;">&#169;2014 SETTING Consultoria en T.I., S.L.</label></td></tr></table>
     </div>-->

</div>

<!-- FEEDBACK -->
<div data-role="page" id="pagePantalla6">
    <div data-role="header" data-theme="c">
        <table style="text-align: center; width: 100%">
            <tr>
                <td style="text-align: left">
                    <h4>FeedBack</h4>
                </td>
            </tr>
        </table>
    </div>
    <div data-role="content" data-theme="c" data-mini="false">
        <div id="acordeon6" data-role="collapsible-set" data-mini="false" data-collased-icon="arrow-r" data-expanded-icon="arrow-l" data-thene="b" data-content-theme="b">
                <div style="text-align:center;">
                    Comunicació notificada [GIVXXXXXXX]
                    Gràcies per la seva col.laboració
                    <!--<a href="#" id="buttonEnviar" onclick="enviarIncidencia()" data-mini="false" data-inline="true" data-role="button" data-theme="c" data-icon="grid">ENVIAR COMUNICAT</a>-->
                </div>
                <table style="width:100%;"><tr><td style="text-align: left; width: 50%;">
                    <td>
                        <a href="#" id="buttonNouComunicat" onclick="" data-mini="true" data-inline="true"data-role="button"data-theme="c" data-icon="delete">Nou</a>
                    </td>
                    <!--<td>
                         <a href="#" id="buttonEnviamentDePendents" onclick="enviamentDePendents()" data-mini="true" data-inline="true" data-role="button" data-theme="c" data-icon="plus">actualitzar</a>
                     </td>-->
                    <td>
                        <a href="#" id="buttonSortir" onclick="" data-mini="true" data-inline="true" data-role="button"  data-icon="grid" data-theme="c">Sortir</a>
                    </td>
                </tr>
                </table>

        </div>
    </div>
</div>


<!-- Página ZOOM -->
<!-- moga
 <div data-role="popup" id="pageZoomFoto"  data-theme="c" style="max-width:95%;display:none;" class="ui-corner-all" class="ui-btn-right">
-->
<div data-role="popup" id="pageZoomFoto"  data-theme="c" style="max-width:95%;" class="ui-corner-all" class="ui-btn-right">

    <div data-role="header" data-theme="c">
        <h3></h3>
    </div>

    <div data-role="content" data-theme="b">
        <p>
            <img id="imgZoomFoto" src="" border='1' width="100%" />
        </p>
        <a href="#pagePantalla3" data-role="button" data-mini="false" data-inline="true" data-theme="c">Tancar</a>
    </div>
</div>




<!-- JAVASCRIPT -->
<script type="text/javascript">
    // EVENTOS ----------------------------------------------------------------------------------------------------------


    $("#inputNUM").bind( "change", function(event, ui) {
        if( muestraDireccion() == '') return;
        crearMarcadorDesdeCalleNum();
    });

    $('#collapsibleQuiSoc').bind('collapse', function () {
        var sUsu =  $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val();
        if(sUsu.trim() == "") sUsu = "[ANÒNIM]";
        $('#labelQUISOC').text(sUsu);
        $.mobile.silentScroll(0);
    });

    $('#collapsibleQuiSoc').bind('expand', function () {
        if (!bAbroPagina)
        {
            $('#collapsibleLocalizacion').trigger('collapse');
            $.mobile.silentScroll(1000);
        }
    });

    $("#check_ComAnonima").bind("change" , function() {
        if($(this).is(':checked')){
            netejarDades();
        }
        else
        {
            var ciu = cargaDatosCiudadano();
            if(ciu=='') $('#inputNOM').focus();
        }
    } )

    $('#inputNOM').focus(function() {
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");
    });

    $('#inputCOGNOM1').focus(function() {
        $('#labelQUISOC').text( $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val() );
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");
    });

    $('#inputCOGNOM2').focus(function() {
        $('#labelQUISOC').text( $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val() );
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");

    });

    $('#inputDNI').focus(function() {
        $('#labelQUISOC').text( $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val() );
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");

    });

    $('#inputEMAIL').focus(function() {
        $('#labelQUISOC').text( $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val() );
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");

    });

    $('#inputTELEFON').focus(function() {
        $('#labelQUISOC').text( $('#inputNOM').val() + ' ' + $('#inputCOGNOM1').val() + ' ' + $('#inputCOGNOM2').val() );
        $('#check_ComAnonima').attr("checked",false).checkboxradio("refresh");

    });

    // Botón 'atrás' sale de la app si está en la pantalla principal y es un Androide ...
    document.addEventListener("backbutton", function(e){
        if($.mobile.activePage.is('#pageIndex')){
            e.preventDefault();
            navigator.app.exitApp();
        }
        else {
            navigator.app.backHistory();
        }
    }, false);

    function salir(){
        navigator.app.exitApp();
    }

    function enrere(){
        navigator.app.backHistory();
    }

    function muestraDireccion(){
        var sSelComboCarrer =  indefinidoOnullToVacio($('#selectCARRER').find(":selected").text());
        if(sSelComboCarrer != '' && sSelComboCarrer != 'Seleccioni el carrer')
        {
            var sTipoVia = sSelComboCarrer.split("(")[1].substr(0, (sSelComboCarrer.split("(")[1].length -1));
            var sCalle = sSelComboCarrer.split("(")[0];
            $('#labelDireccion').text( sTipoVia + ' ' + sCalle + ', ' + $('#inputNUM').val() );
            sCoords ='';
            sCoord_X = '';
            sCoord_Y = '';

            return sTipoVia + ' ' + sCalle + ', ' + $('#inputNUM').val();
            //return sTipoVia + ' ' + sCalle + ', ' + nNumCalle;
        }
        else

        {
            //return new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            iniciaMapaFoto(true);
        }
    }

    function actualizaDireccion(){
        if( muestraDireccion() == '') return;
        crearMarcadorDesdeCalleNum();
    }


    $( document ).on( "mobileinit", function() {
        $.mobile.loader.prototype.options.text = "loading";
        $.mobile.loader.prototype.options.textVisible = false;
        $.mobile.loader.prototype.options.theme = "a";
        $.mobile.loader.prototype.options.html = "";
    });
    $.mobile.loading( "show", {
        text: "foo",
        textVisible: true,
        theme: "z",
        html: ""
    });

</script>

</body>

</html>
